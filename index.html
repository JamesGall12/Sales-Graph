<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Greencare Sales Dashboard - Live</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    /* Your full existing CSS remains unchanged - assumed already styled as shown in your original code */
  </style>
</head>
<body>
  <!-- Your full existing HTML structure here -->

  <script>
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnA9kBH4aes-Z3UQKFtbRbWBPx9TkDoKd48GddRxYM38rZCFq9ZRABBSainXk9WpHaEGVMi2STlk4V/pub?gid=1556175923&single=true&output=csv";
    let charts = {};

    async function fetchSalesData() {
      try {
        const res = await fetch(SHEET_CSV_URL);
        const csvText = await res.text();
        return parseSalesData(csvText);
      } catch (err) {
        console.error('Failed to load sales data:', err);
        return [];
      }
    }

    function parseSalesData(csvText) {
      const lines = csvText.trim().split('\n');
      const salesPeople = [];
      let currentTarget = 0;
      let currentData = {};

      for (let i = 2; i < lines.length; i++) {
        const [label, value] = lines[i].split(',');
        const numValue = parseInt(value) || 0;

        if (label === 'Target 1') {
          currentTarget = numValue;
        } else if (label === 'Projected - Candice') {
          currentData.candiceProjected = numValue;
        } else if (label === 'Candice') {
          salesPeople.push({ name: 'Candice', target: currentTarget, projected: currentData.candiceProjected, actual: numValue });
        } else if (label === 'Target 2') {
          currentTarget = numValue;
        } else if (label === 'Pojected - Kurt') {
          currentData.kurtProjected = numValue;
        } else if (label === 'Kurt') {
          salesPeople.push({ name: 'Kurt', target: currentTarget, projected: currentData.kurtProjected, actual: numValue });
        } else if (label === 'Target 3') {
          currentTarget = numValue;
        } else if (label === 'Pojected - Ed') {
          currentData.edProjected = numValue;
        } else if (label === 'Projected - Jeff') {
          currentData.jeffProjected = numValue;
        } else if (label === 'Ed') {
          salesPeople.push({ name: 'Ed', target: currentTarget, projected: currentData.edProjected, actual: numValue });
        } else if (label === 'Jeff') {
          salesPeople.push({ name: 'Jeff', target: currentTarget, projected: currentData.jeffProjected, actual: numValue });
        }
      }
      return salesPeople;
    }

    async function loadDashboard() {
      const data = await fetchSalesData();
      if (!data.length) {
        document.getElementById('loading').innerHTML = '<p style="color:#ef4444;">Failed to load data</p>';
        return;
      }
      updateDashboard(data);
      document.getElementById('loading').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
    }

    // Your existing updateDashboard, updatePerformanceChart, updateAchievementChart, updateSalesTable functions remain unchanged

    window.addEventListener('load', loadDashboard);
  </script>
</body>
</html>
